#!/usr/bin/env node
require('gnode')

if (typeof process.env.METALSMITH === 'undefined') {
  process.env.NODE_ENV = process.env.NODE_ENV || 'development'
}

var dir = process.cwd()
var Runner = require('../lib/runner')
var program = require('commander')
var fatal = require('../lib/log').fatal

program
  .version(require('../package.json').version)
  .option('-p, --port <port>', 'specify the port', Number)
  .option('-R, --no-livereload', 'disable livereload')
  .parse(process.argv)

try {
  var r = new Runner(dir, program)
  r.start(function (err) {
    if (err) fatal(err.message)
  })
} catch (err) {
  fatal(err.message)
}
